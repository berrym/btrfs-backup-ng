.\" Man page for btrfs-backup-ng config
.TH BTRFS-BACKUP-NG-CONFIG 1 "January 2026" "btrfs-backup-ng" "User Commands"
.SH NAME
btrfs-backup-ng-config \- configuration management commands
.SH SYNOPSIS
.B btrfs-backup-ng config validate
.br
.B btrfs-backup-ng config init
[\fB\-i\fR|\fB\-\-interactive\fR]
[\fB\-o\fR \fIFILE\fR]
.br
.B btrfs-backup-ng config import
[\fB\-o\fR \fIFILE\fR] \fIBTRBK_CONF\fR
.br
.B btrfs-backup-ng config detect
[\fB\-\-json\fR]
[\fB\-w\fR|\fB\-\-wizard\fR]
.SH DESCRIPTION
Manage btrfs-backup-ng configuration files. These commands help create,
validate, detect subvolumes, and migrate configurations.
.SH SUBCOMMANDS
.SS validate
Validate the current configuration file. Checks for syntax errors, missing
required fields, and invalid values.
.PP
.RS
.B btrfs-backup-ng config validate
.RE
.PP
Exit status is 0 if valid, non-zero if errors are found.
.SS init
Generate an example configuration file with comments explaining all options.
Can be run in interactive mode for a guided setup wizard.
.PP
.RS
.B btrfs-backup-ng config init
[\fB\-i\fR|\fB\-\-interactive\fR]
[\fB\-o\fR \fIFILE\fR]
.RE
.TP
.BR \-i ", " \-\-interactive
Run the interactive configuration wizard. This guides you through setting up:
.RS
.IP \(bu 2
Global settings (snapshot directory, timestamp format)
.IP \(bu 2
Parallelism settings
.IP \(bu 2
Retention policies (hourly, daily, weekly, monthly, yearly)
.IP \(bu 2
Email and webhook notifications
.IP \(bu 2
Volumes to backup and their targets
.RE
.IP
Requires a terminal (TTY). Press Ctrl+C to cancel at any time.
.TP
.BR \-o ", " \-\-output " " \fIFILE\fR
Write output to FILE instead of stdout.
.PP
Example:
.PP
.RS
.nf
# Generate example config to stdout
btrfs-backup-ng config init > ~/.config/btrfs-backup-ng/config.toml

# Generate example config to file
btrfs-backup-ng config init -o /etc/btrfs-backup-ng/config.toml

# Run interactive wizard
btrfs-backup-ng config init --interactive

# Run interactive wizard and save to file
btrfs-backup-ng config init -i -o config.toml
.fi
.RE
.SS import
Import a btrbk configuration file and convert it to TOML format. This helps
migrate from btrbk to btrfs-backup-ng.
.PP
.RS
.B btrfs-backup-ng config import
[\fB\-o\fR \fIFILE\fR] \fIBTRBK_CONF\fR
.RE
.TP
.I BTRBK_CONF
Path to the btrbk.conf file to import.
.TP
.BR \-o ", " \-\-output " " \fIFILE\fR
Write output to FILE instead of stdout.
.PP
The importer:
.IP \(bu 2
Parses btrbk's custom syntax
.IP \(bu 2
Resolves inheritance (options cascade down)
.IP \(bu 2
Converts retention policies
.IP \(bu 2
Warns about common btrbk pitfalls
.IP \(bu 2
Outputs valid TOML
.PP
Example:
.PP
.RS
.nf
btrfs-backup-ng config import /etc/btrbk/btrbk.conf
btrfs-backup-ng config import /etc/btrbk/btrbk.conf -o config.toml
.fi
.RE
.SS detect
Scan the system for btrfs subvolumes and suggest backup configurations.
This command helps discover what subvolumes exist on your system and
categorizes them for backup purposes.
.PP
.RS
.B btrfs-backup-ng config detect
[\fB\-\-json\fR]
[\fB\-w\fR|\fB\-\-wizard\fR]
.RE
.TP
.B \-\-json
Output results in JSON format for scripting and automation.
.TP
.BR \-w ", " \-\-wizard
Launch the interactive configuration wizard with detected volumes
pre-populated. Requires a terminal (TTY).
.PP
The detect command:
.IP \(bu 2
Scans all mounted btrfs filesystems
.IP \(bu 2
Lists all subvolumes found
.IP \(bu 2
Categorizes subvolumes as recommended, optional, or excluded
.IP \(bu 2
Suggests snapshot prefixes based on mount paths
.IP \(bu 2
Identifies existing snapshots and system-internal subvolumes
.PP
Subvolume categories:
.IP \(bu 2
\fBRecommended\fR: User data directories like /home that should be backed up
.IP \(bu 2
\fBOptional\fR: System data (/opt, /var/log) that may or may not need backup
.IP \(bu 2
\fBExcluded\fR: Existing snapshots and system-internal subvolumes
.PP
Example:
.PP
.RS
.nf
# Scan for subvolumes (requires root for full access)
sudo btrfs-backup-ng config detect

# Output in JSON format
sudo btrfs-backup-ng config detect --json

# Launch wizard with detected volumes
sudo btrfs-backup-ng config detect --wizard
.fi
.RE
.SH CONFIGURATION FORMAT
Configuration uses TOML format. Key sections:
.SS [global]
Global settings applied to all volumes unless overridden.
.PP
.RS
.nf
[global]
snapshot_dir = ".snapshots"
timestamp_format = "%Y%m%d-%H%M%S"
incremental = true
log_file = "/var/log/btrfs-backup-ng.log"
parallel_volumes = 2
parallel_targets = 2
.fi
.RE
.SS [global.retention]
Default retention policy.
.PP
.RS
.nf
[global.retention]
min = "1d"
hourly = 24
daily = 7
weekly = 4
monthly = 12
yearly = 0
.fi
.RE
.SS [[volumes]]
Volume definitions. Each volume specifies a source path and targets.
.PP
.RS
.nf
[[volumes]]
path = "/home"
snapshot_prefix = "home-"
snapshot_dir = ".snapshots"  # optional override

[[volumes.targets]]
path = "/mnt/backup/home"

[[volumes.targets]]
path = "ssh://backup@server:/backups/home"
ssh_sudo = true
compress = "zstd"
rate_limit = "50M"

[volumes.retention]  # optional override
daily = 14
.fi
.RE
.SS [notifications]
Optional notification settings.
.PP
.RS
.nf
[notifications]
on_success = false
on_failure = true

[notifications.email]
smtp_host = "smtp.example.com"
smtp_port = 587
from_addr = "backup@example.com"
to_addrs = ["admin@example.com"]
use_tls = true
username = "backup@example.com"
password = "secret"

[notifications.webhook]
url = "https://hooks.example.com/backup"
.fi
.RE
.SH FILES
.TP
.I ~/.config/btrfs-backup-ng/config.toml
User configuration file.
.TP
.I /etc/btrfs-backup-ng/config.toml
System-wide configuration file.
.SH SEE ALSO
.BR btrfs-backup-ng (1),
.BR toml (5)
